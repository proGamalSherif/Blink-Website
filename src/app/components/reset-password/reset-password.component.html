<section class="max-vh-100">
  <div class="containr2">
    <div class="container3">
      <div class="row">
        <div class="col-md-6">
          <div>
            <img
              src="./assets/images/register.png"
              alt="Reset Password"
              class="img-fluid h-75"
            />
          </div>
        </div>

        <div class="col-md-6 px-5 d-flex align-items-center">
          <div class="px-5 mx-4 w-100">
            <p class="title mt-2 mb-3">Forgot Password</p>

            <!-- Step 1: Email Input -->
            <form *ngIf="step === 1" [formGroup]="resetForm" (ngSubmit)="verifiyEmail()">
              <div class="mb-4">
                <input
                  formControlName="email"
                  type="email"
                  class="custom-input"
                  id="resetEmail"
                  placeholder="Enter your email"
                />
                <div
                  class="text-danger mt-1 "
                  *ngIf="resetForm.get('email')?.errors && resetForm.get('email')?.touched"
                >
                  <p *ngIf="resetForm.get('email')?.getError('required')">
                    Email is required
                  </p>
                  <p *ngIf="resetForm.get('email')?.getError('email')">
                    Please enter a valid email
                  </p>
                </div>
              </div>
              <button
                [disabled]="resetForm.invalid"
                type="submit"
                class="btn  submit mx-auto mt-5 d-block text-white px-lg-3 w-50"
              >
                Continue
                <i *ngIf="isLoading" class="fas fa-spinner fa-spin ms-2"></i>
              </button>
            </form>

            <!-- Step 2: Verification Code -->
            <form *ngIf="step === 2" [formGroup]="verifyCode" (ngSubmit)="verifyCodeFunc()">
              <div class="mb-4">
                <p class="mb-3">We sent a verification code to your email</p>
                <input
                  formControlName="code"
                  type="text"
                  class="custom-input"
                  id="verificationCode"
                  placeholder="Enter 6-digit code"
                  maxlength="6"
                />
                <div
                  class="text-danger mt-1 "
                  *ngIf="verifyCode.get('code')?.errors && verifyCode.get('code')?.touched"
                >
                  <p *ngIf="verifyCode.get('code')?.getError('required')">
                    Verification code is required
                  </p>
                  <p *ngIf="verifyCode.get('code')?.getError('pattern')">
                    Please enter a valid 6-digit code
                  </p>
                </div>
              </div>
              <button
                [disabled]="verifyCode.invalid"
                type="submit"
                class="btn submit mx-auto mt-5 d-block text-white px-lg-3 w-50"
              >
                Verify Code
                <i *ngIf="isLoading" class="fas fa-spinner fa-spin ms-2"></i>
              </button>
            </form>

            <!-- Step 3: New Password -->
            <form *ngIf="step === 3" [formGroup]="newPassword" (ngSubmit)="setNewPassword()">
              <div class="mb-3">
                <input
                  formControlName="newPassword"
                  type="password"
                  class="custom-input"
                  id="newPassword"
                  placeholder="Enter new password"
                />
                <div
                  class="text-danger mt-1 "
                  *ngIf="newPassword.get('newPassword')?.errors && newPassword.get('newPassword')?.touched"
                >
                  <p *ngIf="newPassword.get('newPassword')?.getError('required')">
                    Password is required
                  </p>
                  <p *ngIf="newPassword.get('newPassword')?.getError('pattern')">
                    Password must be at least 8 characters with uppercase, number, and special character
                  </p>
                </div>
              </div>
              <div class="mb-4">
                <input
                  formControlName="confirmPassword"
                  type="password"
                  class="custom-input"
                  id="confirmPassword"
                  placeholder="Confirm new password"
                />
                <div
                  class="text-danger mt-1 custom-input-error"
                  *ngIf="newPassword.get('confirmPassword')?.errors && newPassword.get('confirmPassword')?.touched"
                >
                  <p *ngIf="newPassword.get('confirmPassword')?.getError('required')">
                    Please confirm your password
                  </p>
                  <p *ngIf="newPassword.get('confirmPassword')?.getError('mismatch')">
                    Passwords don't match
                  </p>
                </div>
              </div>
              <button
                [disabled]="newPassword.invalid"
                type="submit"
                class="btn submit mx-auto mt-5 d-block text-white px-lg-3 w-50"
              >
                Reset Password
                <i *ngIf="isLoading" class="fas fa-spinner fa-spin ms-2"></i>
              </button>
            </form>

            <p class="text-danger mt-3 text-center" *ngIf="msgerror">
              {{ msgerror }}
            </p>

            <div class="text-center mt-4">
              <a routerLink="/login" class="btn btn-link text-dark">
                Back to Login
              </a>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>